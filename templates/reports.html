{% extends "base.html" %} {% block title %}Financial Reports{% endblock %} {%
block content %}
<h1>Financial Reports</h1>
<div id="date-range">
  <label for="start-date">Start Date:</label>
  <input type="date" id="start-date" />
  <label for="end-date">End Date:</label>
  <input type="date" id="end-date" />
  <button id="update-report" class="btn">Update Report</button>
</div>
<div id="summary">
  <h2>Summary</h2>
  <p>Total Income: $<span id="report-total-income"></span></p>
  <p>Total Expenses: $<span id="report-total-expenses"></span></p>
  <p>Net Income: $<span id="report-net-income"></span></p>
</div>
<div class="chart-container">
  <canvas id="expense-category-chart"></canvas>
</div>
<h2>Transactions</h2>
<table id="transactions">
  <thead>
    <tr>
      <th>Date</th>
      <th>Type</th>
      <th>Amount</th>
      <th>Description</th>
      <th>Category</th>
    </tr>
  </thead>
  <tbody>
    <!-- Transactions will be populated here by JavaScript -->
  </tbody>
</table>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  $(document).ready(function () {
    // Function to fetch report data and update the UI
    function fetchReportData() {
      var startDate = $("#start-date").val();
      var endDate = $("#end-date").val();

      $.get(
        "/api/report_data",
        { start_date: startDate, end_date: endDate },
        function (data) {
          $("#report-total-income").text(data.total_income);
          $("#report-total-expenses").text(data.total_expenses);
          $("#report-net-income").text(data.net_income);

          // Populate the transactions table
          var transactionsTable = $("#transactions tbody");
          transactionsTable.empty();
          data.transactions.forEach(function (transaction) {
            var row =
              "<tr>" +
              "<td>" +
              transaction.date +
              "</td>" +
              "<td>" +
              transaction.type +
              "</td>" +
              "<td>" +
              transaction.amount +
              "</td>" +
              "<td>" +
              transaction.description +
              "</td>" +
              "<td>" +
              transaction.category +
              "</td>" +
              "</tr>";
            transactionsTable.append(row);
          });
        }
      );

      // Fetch chart data
      $.get(
        "/api/chart-data",
        { start_date: startDate, end_date: endDate },
        function (data) {
          // Update the expense category chart
          var ctx = document
            .getElementById("expense-category-chart")
            .getContext("2d");
          var chart = new Chart(ctx, {
            type: "pie",
            data: {
              labels: Object.keys(data),
              datasets: [
                {
                  data: Object.values(data),
                  backgroundColor: [
                    "#FF6384",
                    "#36A2EB",
                    "#FFCE56",
                    "#4BC0C0",
                    "#9966FF",
                    "#FF9F40",
                  ],
                },
              ],
            },
            options: {
              responsive: true,
              title: {
                display: true,
                text: "Expenses by Category",
              },
            },
          });
        }
      );
    }

    // Fetch report data on page load
    fetchReportData();

    // Fetch report data when the update button is clicked
    $("#update-report").click(function () {
      fetchReportData();
    });
  });
</script>
{% endblock %}
